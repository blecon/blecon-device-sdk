# Copyright (c) Blecon Ltd
# SPDX-License-Identifier: Apache-2.0

# Select internal modem
CONFIG_BLECON_EXTERNAL_MODEM=n
CONFIG_BLECON_INTERNAL_MODEM=y
CONFIG_BLECON_INTERNAL_MODEM_NFC=y

# Internal modem platform
CONFIG_BLECON_PORT_CRYPTO=y
CONFIG_BLECON_PORT_NVM=y
CONFIG_BLECON_PORT_BLUETOOTH=y
CONFIG_BLECON_PORT_EVENT_LOOP=y
CONFIG_BLECON_PORT_NFC=y

# Bluetooth
CONFIG_BT=y
CONFIG_BT_PERIPHERAL=y
CONFIG_BT_OBSERVER=y
CONFIG_BT_USER_PHY_UPDATE=y

# At the moment, the following options are required to get L2CAP dynamic channels enabled
CONFIG_BT_SMP=y
# CONFIG_BT_CONN_DISABLE_SECURITY=y
CONFIG_BT_PRIVACY=n

CONFIG_BT_EXT_ADV=y
CONFIG_BT_L2CAP_DYNAMIC_CHANNEL=y
CONFIG_BT_L2CAP_SEG_RECV=y
CONFIG_BT_EXT_ADV_MAX_ADV_SET=3
CONFIG_BT_ID_MAX=3
CONFIG_BT_LONG_WQ=n
CONFIG_BT_BONDABLE=n
CONFIG_BT_GATT_SERVICE_CHANGED=n
CONFIG_BT_GATT_CACHING=n
CONFIG_BT_GATT_ENFORCE_SUBSCRIPTION=n
CONFIG_BT_GATT_READ_MULTIPLE=n
CONFIG_BT_DEVICE_NAME="Blecon"
CONFIG_BT_DIS=y
CONFIG_BT_DIS_PNP=n
CONFIG_BT_ECC=n

# Needs to be 1 + number of expected connections; See: https://devzone.nordicsemi.com/f/nordic-q-a/77588/advertising-failed-to-start-err--12/321268
CONFIG_BT_MAX_CONN=2

# Connection parameter update procedure
CONFIG_BT_CONN_PARAM_UPDATE_TIMEOUT=500

# DLE
CONFIG_BT_USER_DATA_LEN_UPDATE=y

# Needed to achieve MTU without fragmentation
CONFIG_BT_BUF_ACL_TX_COUNT=8
CONFIG_BT_BUF_ACL_TX_SIZE=251
CONFIG_BT_BUF_ACL_RX_SIZE=251
CONFIG_BT_L2CAP_TX_MTU=247

# Increase HCI RX stack size
CONFIG_BT_RX_STACK_SIZE=4096

# Bluetooth controller
# Uncomment to use the Zephyr link layer
# CONFIG_BT_LL_SW_SPLIT=y
CONFIG_BT_CTLR_CRYPTO=n
CONFIG_BT_CTLR_LE_ENC=n
CONFIG_BT_CTLR_ECDH=n
CONFIG_BT_CTLR_PHY_2M=n
CONFIG_BT_CTLR_PRIVACY=n
CONFIG_BT_LL_SOFTDEVICE_MULTIROLE=y
CONFIG_BT_CTLR_DATA_LENGTH_MAX=251

# NFC
CONFIG_NFC_T2T_NRFXLIB=y
CONFIG_NFC_NDEF_URI_MSG=y
CONFIG_NFC_NDEF=y
CONFIG_NFC_NDEF_MSG=y
CONFIG_NFC_NDEF_RECORD=y
CONFIG_NFC_NDEF_URI_REC=y

# Crypto
CONFIG_ENTROPY_GENERATOR=y

CONFIG_NRF_SECURITY=y
CONFIG_MBEDTLS_PSA_CRYPTO_C=y

CONFIG_MBEDTLS_ENABLE_HEAP=y
CONFIG_MBEDTLS_HEAP_SIZE=8192

# NVM
CONFIG_FLASH=y
CONFIG_FLASH_PAGE_LAYOUT=y

# Reduce logging buffer size
CONFIG_LOG_BUFFER_SIZE=2048

# Reduce large request buffer size
CONFIG_LARGE_REQUEST_EXAMPLE_BUFFER_SZ=16384
